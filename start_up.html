<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>快速上手 | Luban使用文档</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/lubandoc/logo.jpg">
    <meta name="description" content="">
    
    <link rel="preload" href="/lubandoc/assets/css/0.styles.8c5bd95f.css" as="style"><link rel="preload" href="/lubandoc/assets/js/app.8b947d15.js" as="script"><link rel="preload" href="/lubandoc/assets/js/2.e9b74d21.js" as="script"><link rel="preload" href="/lubandoc/assets/js/34.aeee1c9f.js" as="script"><link rel="prefetch" href="/lubandoc/assets/js/10.833d4cb3.js"><link rel="prefetch" href="/lubandoc/assets/js/11.f69ee773.js"><link rel="prefetch" href="/lubandoc/assets/js/12.2f951782.js"><link rel="prefetch" href="/lubandoc/assets/js/13.a471fa8d.js"><link rel="prefetch" href="/lubandoc/assets/js/14.32dbe354.js"><link rel="prefetch" href="/lubandoc/assets/js/15.8300389b.js"><link rel="prefetch" href="/lubandoc/assets/js/16.a99f9bba.js"><link rel="prefetch" href="/lubandoc/assets/js/17.3f3b5252.js"><link rel="prefetch" href="/lubandoc/assets/js/18.a96ff7c2.js"><link rel="prefetch" href="/lubandoc/assets/js/19.35370474.js"><link rel="prefetch" href="/lubandoc/assets/js/20.124f4f6c.js"><link rel="prefetch" href="/lubandoc/assets/js/21.d44d88a7.js"><link rel="prefetch" href="/lubandoc/assets/js/22.4cf1f47c.js"><link rel="prefetch" href="/lubandoc/assets/js/23.4d249f52.js"><link rel="prefetch" href="/lubandoc/assets/js/24.d6d254db.js"><link rel="prefetch" href="/lubandoc/assets/js/25.857ad9a1.js"><link rel="prefetch" href="/lubandoc/assets/js/26.aaf272bf.js"><link rel="prefetch" href="/lubandoc/assets/js/27.655bd600.js"><link rel="prefetch" href="/lubandoc/assets/js/28.30354203.js"><link rel="prefetch" href="/lubandoc/assets/js/29.a52ded49.js"><link rel="prefetch" href="/lubandoc/assets/js/3.52c46d17.js"><link rel="prefetch" href="/lubandoc/assets/js/30.2ccec016.js"><link rel="prefetch" href="/lubandoc/assets/js/31.66bf5ef0.js"><link rel="prefetch" href="/lubandoc/assets/js/32.23973e62.js"><link rel="prefetch" href="/lubandoc/assets/js/33.bb63393c.js"><link rel="prefetch" href="/lubandoc/assets/js/35.a081974a.js"><link rel="prefetch" href="/lubandoc/assets/js/36.f403e84c.js"><link rel="prefetch" href="/lubandoc/assets/js/37.6e5bd6b9.js"><link rel="prefetch" href="/lubandoc/assets/js/38.e6645769.js"><link rel="prefetch" href="/lubandoc/assets/js/4.afc2c684.js"><link rel="prefetch" href="/lubandoc/assets/js/5.e7d128b2.js"><link rel="prefetch" href="/lubandoc/assets/js/6.3f529888.js"><link rel="prefetch" href="/lubandoc/assets/js/7.9b79da85.js"><link rel="prefetch" href="/lubandoc/assets/js/8.f7463651.js"><link rel="prefetch" href="/lubandoc/assets/js/9.9df6d74b.js">
    <link rel="stylesheet" href="/lubandoc/assets/css/0.styles.8c5bd95f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/lubandoc/" class="home-link router-link-active"><!----> <span class="site-name">Luban使用文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/focus-creative-games/luban" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/focus-creative-games/luban" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/lubandoc/Home.html" class="sidebar-link">Home</a></li><li><a href="/lubandoc/start_up.html" aria-current="page" class="active sidebar-link">快速上手</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lubandoc/start_up.html#视频教程" class="sidebar-link">视频教程</a></li><li class="sidebar-sub-header"><a href="/lubandoc/start_up.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/lubandoc/start_up.html#创建游戏配置" class="sidebar-link">创建游戏配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lubandoc/start_up.html#准备基础的配置模板" class="sidebar-link">准备基础的配置模板</a></li><li class="sidebar-sub-header"><a href="/lubandoc/start_up.html#定义一个新的配置表-此步骤可跳过" class="sidebar-link">定义一个新的配置表 (== 此步骤可跳过 ==)</a></li></ul></li><li class="sidebar-sub-header"><a href="/lubandoc/start_up.html#生成代码和数据以及在程序中使用" class="sidebar-link">生成代码和数据以及在程序中使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lubandoc/start_up.html#unity-c-json" class="sidebar-link">unity + c# + json</a></li></ul></li><li class="sidebar-sub-header"><a href="/lubandoc/start_up.html#unity-puerts-项目生成-ts代码-并生成json数据" class="sidebar-link">unity + puerts 项目生成 ts代码，并生成json数据</a></li><li class="sidebar-sub-header"><a href="/lubandoc/start_up.html#我是ue4项目-想生成c-代码-非蓝图-和binary数据该怎么做" class="sidebar-link">我是UE4项目，想生成c++代码（非蓝图）和binary数据该怎么做</a></li><li class="sidebar-sub-header"><a href="/lubandoc/start_up.html#我是ue4项目-想生成c-代码-蓝图-和binary数据该怎么做" class="sidebar-link">我是UE4项目，想生成c++代码（蓝图）和binary数据该怎么做</a></li><li class="sidebar-sub-header"><a href="/lubandoc/start_up.html#我是ue4项目-想生成c-代码-蓝图-和json数据该怎么做" class="sidebar-link">我是UE4项目，想生成c++代码（蓝图）和json数据该怎么做</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lubandoc/start_up.html#只想根据excel导出json数据-自己手写代码加载使用" class="sidebar-link">只想根据excel导出json数据，自己手写代码加载使用</a></li></ul></li><li class="sidebar-sub-header"><a href="/lubandoc/start_up.html#其他项目类型" class="sidebar-link">其他项目类型</a></li></ul></li><li><a href="/lubandoc/best_practices.html" class="sidebar-link">最佳实践</a></li><li><a href="/lubandoc/feature.html" class="sidebar-link">完整特性</a></li><li><a href="/lubandoc/FAQ.html" class="sidebar-link">FAQ</a></li><li><a href="/lubandoc/command_tools.html" class="sidebar-link">luban命令行工具</a></li><li><a href="/lubandoc/editor.html" class="sidebar-link">Editor支持</a></li><li><a href="/lubandoc/define.html" class="sidebar-link">配置定义</a></li><li><a href="/lubandoc/excel.html" class="sidebar-link">excel格式介绍</a></li><li><a href="/lubandoc/excel_sep.html" class="sidebar-link">excel sep使用介绍</a></li><li><a href="/lubandoc/dynamic_bean.html" class="sidebar-link">多态配置使用介绍</a></li><li><a href="/lubandoc/validator.html" class="sidebar-link">数据校验器</a></li><li><a href="/lubandoc/generate_code_data.html" class="sidebar-link">代码与数据生成</a></li><li><a href="/lubandoc/load_config_at_runtime.html" class="sidebar-link">项目中加载与使用配置</a></li><li><a href="/lubandoc/template.html" class="sidebar-link">自定义代码与数据模板</a></li><li><a href="/lubandoc/tag.html" class="sidebar-link">记录tag与过滤导出</a></li><li><a href="/lubandoc/data_json.html" class="sidebar-link">json数据源</a></li><li><a href="/lubandoc/data_xml.html" class="sidebar-link">xml数据源</a></li><li><a href="/lubandoc/data_yaml.html" class="sidebar-link">yaml数据源</a></li><li><a href="/lubandoc/l10n.html" class="sidebar-link">本地化</a></li><li><a href="/lubandoc/excel2textdiff.html" class="sidebar-link">Excel2TextDiff工具</a></li><li><a href="/lubandoc/luban_assistant.html" class="sidebar-link">LubanAssistant Excel插件</a></li><li><a href="/lubandoc/changelog.html" class="sidebar-link">更新日志</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="快速上手"><a href="#快速上手" class="header-anchor">#</a> 快速上手</h1> <h2 id="视频教程"><a href="#视频教程" class="header-anchor">#</a> 视频教程</h2> <p>== <strong>感谢 <a href="https://space.bilibili.com/1916310" target="_blank" rel="noopener noreferrer"><strong>宝鱼偷偷摸鱼</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的贡献</strong> ==</p> <ul><li><a href="https://www.bilibili.com/video/BV1xS4y1M7Aj" target="_blank" rel="noopener noreferrer"><strong>【01】新手上路</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.bilibili.com/video/BV1m44y1j747" target="_blank" rel="noopener noreferrer"><strong>【02】定义配置结构</strong><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <ol><li><p><a href="https://dotnet.microsoft.com/download/dotnet/6.0" target="_blank" rel="noopener noreferrer">dotnet sdk 6.0<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>下载luban_examples项目</p> <p>下载项目 <a href="https://github.com/focus-creative-games/luban_examples" target="_blank" rel="noopener noreferrer">luban_examples<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。
项目中包含测试配置、最新的luban_client&amp;luban_server工作以及大量的示例项目。为方便起见，后续提及到的文件，默认都指这个项目中的文件。</p></li></ol> <h2 id="创建游戏配置"><a href="#创建游戏配置" class="header-anchor">#</a> 创建游戏配置</h2> <h3 id="准备基础的配置模板"><a href="#准备基础的配置模板" class="header-anchor">#</a> 准备基础的配置模板</h3> <p>从示例项目拷贝<a href="https://github.com/focus-creative-games/luban_examples/tree/main/MiniDesignerConfigsTemplate" target="_blank" rel="noopener noreferrer">MiniDesignerConfigsTemplate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 到一个合适的目录，假设为 <strong>MyConfigs</strong></p> <h3 id="定义一个新的配置表-此步骤可跳过"><a href="#定义一个新的配置表-此步骤可跳过" class="header-anchor">#</a> 定义一个新的配置表 (== 此步骤可跳过 ==)</h3> <p>基础配置模板里已经包含了一个item.xlsx示例表，可以直接生成。如果你想体验一下如何创建一个新的配置表，
可以按照下面的步骤操作，否则<strong>可以快速直接跳过</strong>。</p> <p>假设这个新表为reward表。</p> <ul><li><p>添加excel配置数据文件
在 MyConfigs/Datas 目录下创建一个 “reward.xlsx” 文件。</p> <p>文件内容如下</p> <table><thead><tr><th>##var</th> <th>id</th> <th>name</th> <th>desc</th> <th>count</th></tr></thead> <tbody><tr><td>##type</td> <td>int</td> <td>string</td> <td>string</td> <td>int</td></tr> <tr><td>##</td> <td>id</td> <td>名字</td> <td>描述</td> <td>个数</td></tr> <tr><td></td> <td>1001</td> <td>item1</td> <td>desc1</td> <td>10</td></tr> <tr><td></td> <td>1002</td> <td>item2</td> <td>desc2</td> <td>10</td></tr> <tr><td></td> <td>1003</td> <td>item3</td> <td>desc3</td> <td>10</td></tr> <tr><td></td> <td>1004</td> <td>item4</td> <td>desc4</td> <td>10</td></tr></tbody></table> <ul><li>第 1 行是 主字段行，包含表字段定义。单元格 A1 必须以##开头。表示这是一个有效数据表。</li> <li>第 2 行是类型行，第1个单元格必须为 ##type。</li> <li>第 3 行是注释行。 以##开头。 可以有0-N个注释行，而且可以出现在任何位置</li> <li>第 4 行起是数据行。</li></ul> <p><strong>像##var或者##type 这种带名字的行，可以随便调整行的位置。</strong> <strong>==但注意==</strong> 如果第一行是注释行，必须使用##comment，而不是##。否则会把第一行当字段名行而出错（这是出于兼容性，早期强制第一行是字段名行，允许只以##开头）。</p></li> <li><p>在 Datas 目录下的__tables__.xlsx添加表声明，如下图：</p> <table><thead><tr><th>##var</th> <th>full_name</th> <th>value_type</th> <th>define_from_file</th> <th>input</th> <th>index</th> <th>mode</th> <th>group</th> <th>comment</th> <th>patch_input</th> <th>tags</th> <th>output</th></tr></thead> <tbody><tr><td></td> <td>demo.TbReward</td> <td>Reward</td> <td>true</td> <td>reward.xlsx</td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td></tr></tbody></table></li> <li><p>至此reward表的创建工作大功告成!</p></li></ul> <h2 id="生成代码和数据以及在程序中使用"><a href="#生成代码和数据以及在程序中使用" class="header-anchor">#</a> 生成代码和数据以及在程序中使用</h2> <p>有几个常见需求， 根据你的要求选择下面合适的文档</p> <ul><li>unity + c# + json</li> <li>unity + puerts + json</li> <li>UE4 + c++ + binary</li> <li>UE4 + blueprint c++ + binary</li> <li>UE4 + blueprint c++ + json</li> <li>只想excel导出json，自己手写代码加载或者有其他使用目的</li> <li>其他需求</li></ul> <h3 id="unity-c-json"><a href="#unity-c-json" class="header-anchor">#</a> unity + c# + json</h3> <p>示例参考项目为 <a href="https://github.com/focus-creative-games/luban_examples/tree/main/Projects/Csharp_Unity_json" target="_blank" rel="noopener noreferrer">Csharp_Unity_Json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <ul><li><p>项目准备。</p> <p>拷贝示例项目中 Assets\LubanLib 目录到你的Unity项目中（可以自由组织位置），<strong>===同时在Unity的PlayerSettings里开启unsafe选项===</strong>（如果你们项目要求不开启unsafe，请群里求助）,此时尝试编译项目，理论上应该能成功编译。</p></li> <li><p>运行生成命令（可以参考示例项目的gen_code_json.bat）</p> <div class="language-bat line-numbers-mode"><pre class="language-text"><code>    dotnet %Luban.ClientServer.dll%
    -j cfg ^
    -- ^
    --define_file &lt;__root__.xml 定义文件的路径&gt; ^
    --input_data_dir &lt;配置数据根目录(Datas)的路径&gt; ^
    --output_code_dir &lt;生成的代码文件的路径&gt; ^
    --output_data_dir &lt;导出的数据文件的路径&gt; ^
    --service all ^
    --gen_types &quot;code_cs_unity_json,data_json&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>其中</p> <ul><li><p>%Luban.ClientServer.dll% 指向  luban_examples/Tools/Luban.ClientServer/Luban.ClientServer.dll</p></li> <li><p>--define_file  参数为 MyConfigs/Defines/__root__.xml 的路径</p></li> <li><p>--input_data_dir 参数为 MyConfigs/Datas 的路径</p></li> <li><p>--output_code_dir 参数为生成的代码文件存放的路径。 建议建议指向 unity的 Assets 目录下的某级子目录</p></li> <li><p>--output_data_dir 参数为生成的数据文件的存放路径。 建议指向Assets同级目录。</p> <p>详细的命令文档请看 <a href="/lubandoc/luban.wiki/command_tools.html">command_tools</a>。</p> <p>如果一切正常，会产生一系列日志，最终一行是 == succ == 。</p> <p>类似这样</p> <p><img src="images/install/install_07.png" alt="生成结果"></p> <p>如果一切顺利。生成的代码文件会在 –output_code_dir 参数指定的 目录中，生成的配置数据会在 –output_data_dir 参数指定的目录中。确保 –output_code_dir 指向的目录在Assets目录下，<strong>PlayerSetting里开启unsafe</strong>，此时应该能编译成功。</p></li></ul></li> <li><p>加载配置</p> <p>只需一行代码既可完成所有配置表的加载工具</p> <div class="language-c# line-numbers-mode"><pre class="language-text"><code>var tables = new cfg.Tables(file =&gt; JSON.Parse(File.ReadAllText(gameConfDir + &quot;/&quot; + file + &quot;.json&quot;)));
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>使用加载后的配置表</p> <p>cfg.Tables 里包含所有配置表的一个实例字段。加载完 cfg.Tables 后，只需要用 tables.&lt;表名&gt; 就能获得那个表实例，接着可以做各种操作。例如我们要获取id = 10000 的那个道具。代码如下</p> <div class="language-c# line-numbers-mode"><pre class="language-text"><code>cfg.item.Item itemInfo = tables.TbItem.Get(10000);
Console.WriteLine(&quot;id:{0} name:{1} desc:{2}&quot;, itemInfo.Id, itemInfo.Name, itemInfo.Desc);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>可能你会注意到，item.xml 里定义 Item 时，字段名 id,name,desc的首字母被大写了。这是因为工具会根据输出的语言，自动作相应代码风格的字段名转换，也即 boo_bar 会被转换为 BooBar 这样的名字。这也是为什么推荐 配置字段定义时统一使用 xx_yy_zz 的风格。</p></li> <li><p>至此完成 配置加载与使用!</p></li></ul> <h2 id="unity-puerts-项目生成-ts代码-并生成json数据"><a href="#unity-puerts-项目生成-ts代码-并生成json数据" class="header-anchor">#</a> unity + puerts 项目生成 ts代码，并生成json数据</h2> <p>参考项目为 <a href="https://github.com/focus-creative-games/luban_examples/tree/main/Projects/TypeScript_Unity_Puerts_Json" target="_blank" rel="noopener noreferrer">TypeScript_Unity_Puerts_Json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><p>创建并且运行生成命令（可以参考示例项目的gen_code_json.bat）</p> <div class="language-bat line-numbers-mode"><pre class="language-text"><code>dotnet %Luban.ClientServer.dll%
-j cfg ^
-- ^
--define_file &lt;__root__.xml 定义文件的路径&gt; ^
--input_data_dir &lt;配置数据根目录(Datas)的路径&gt; ^
--output_code_dir &lt;生成的代码文件的路径&gt; ^
--output_data_dir &lt;导出的数据文件的路径&gt; ^
--service all ^
--gen_types code_typescript_json,data_json ^
--typescript:use_puerts_bytebuf ^
--typescript:embed_bright_types 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>其中</p> <ul><li><p>%Luban.ClientServer.dll% 指向  luban_examples/Tools/Luban.ClientServer/Luban.ClientServer.dll</p></li> <li><p>--define_file  参数为 MyConfigs/Defines/__root__.xml 的路径</p></li> <li><p>--input_data_dir 参数为 MyConfigs/Datas 的路径</p></li> <li><p>--output_code_dir 参数为生成的代码文件存放的路径。 建议建议指向 unity的 Assets 目录下的某级子目录</p></li> <li><p>--output_data_dir 参数为生成的数据文件的存放路径。 建议指向Assets同级目录。</p> <p>详细的命令文档请看 <a href="/lubandoc/luban.wiki/command_tools.html">command_tools</a>。</p> <p>如果一切正常，会产生一系列日志，最终一行是 == succ == 。</p></li></ul></li> <li><p>加载配置</p> <p>为cfg.Tables提供一个Loader,根据表名返回一个加载好的JSON对象。只需少量代码既可完成所有配置表的加载工具。</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token keyword">let</span> tables <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">cfg</span><span class="token punctuation">.</span><span class="token function">Tables</span><span class="token punctuation">(</span>f <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> JsHelpers<span class="token punctuation">.</span><span class="token function">ReadAllText</span><span class="token punctuation">(</span>UnityEngine<span class="token punctuation">.</span>Application<span class="token punctuation">.</span>dataPath <span class="token operator">+</span> <span class="token string">&quot;GameData/&quot;</span> <span class="token operator">+</span> f <span class="token operator">+</span> <span class="token string">&quot;.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>使用加载后的配置表</p> <p>cfg.Tables 里包含所有配置表的一个实例字段。加载完 cfg.Tables 后，只需要用 tables.&lt;表名&gt; 就能获得那个表实例，接着可以做各种操作。例如我们要获取id = 10000 的那个道具。代码如下</p> <div class="language-typescript line-numbers-mode"><pre class="language-typescript"><code><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tables<span class="token punctuation">.</span>TbGlobalConfig<span class="token punctuation">.</span>bagCapacity<span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tables<span class="token punctuation">.</span>TbItem<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>至此完成 配置加载与使用!</p></li></ul> <h2 id="我是ue4项目-想生成c-代码-非蓝图-和binary数据该怎么做"><a href="#我是ue4项目-想生成c-代码-非蓝图-和binary数据该怎么做" class="header-anchor">#</a> 我是UE4项目，想生成c++代码（非蓝图）和binary数据该怎么做</h2> <p>基准的参考项目为 <a href="https://github.com/focus-creative-games/luban_examples/tree/main/Projects/Cpp_Unreal_bin" target="_blank" rel="noopener noreferrer">Cpp_Unreal_bin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>由于生成的代码依赖于一些头文件，你需要先从该项目 拷备Source\Cpp_Unreal\Private\bright 到你们项目合适的位置。必须保证bright目录在include目录路径内，如生成的代码中 #include &quot;bright/serialization/ByteBuf.h&quot; 可以找到这个文件。</p> <p>接着命令行参数取 --gen_types &quot;code_cpp_bin,data_bin&quot;</p> <h2 id="我是ue4项目-想生成c-代码-蓝图-和binary数据该怎么做"><a href="#我是ue4项目-想生成c-代码-蓝图-和binary数据该怎么做" class="header-anchor">#</a> 我是UE4项目，想生成c++代码（蓝图）和binary数据该怎么做</h2> <p>基准的参考项目为 <a href="https://github.com/focus-creative-games/luban_examples/tree/main/Projects/Cpp_Unreal_bp_binary" target="_blank" rel="noopener noreferrer">Cpp_Unreal_bp_bin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>接着命令行参数取 --gen_types &quot;code_cpp_ue_bp_bin,data_bin&quot;</p> <h2 id="我是ue4项目-想生成c-代码-蓝图-和json数据该怎么做"><a href="#我是ue4项目-想生成c-代码-蓝图-和json数据该怎么做" class="header-anchor">#</a> 我是UE4项目，想生成c++代码（蓝图）和json数据该怎么做</h2> <p>基准的参考项目为 <a href="https://github.com/focus-creative-games/luban_examples/tree/main/Projects/Cpp_Unreal_bp_json" target="_blank" rel="noopener noreferrer">Cpp_Unreal_bp_json<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>接着命令行参数取 --gen_types &quot;code_cpp_ue_bp_json,data_json&quot;</p> <h3 id="只想根据excel导出json数据-自己手写代码加载使用"><a href="#只想根据excel导出json数据-自己手写代码加载使用" class="header-anchor">#</a> 只想根据excel导出json数据，自己手写代码加载使用</h3> <p>示例为 <a href="https://github.com/focus-creative-games/luban_examples/tree/main/Projects/Csharp_Unity_json" target="_blank" rel="noopener noreferrer">GenerateDatas项目<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 下的 gen_data_json2.bat
（注意不是gen_data_json.bat,因为gen_data_json.bat中'--gen_types data_json',生成的json数据为记录列表，而不是以key-value形式组织，可能并不符合你的要求）。</p> <p>脚本如下：</p> <div class="language-bat line-numbers-mode"><pre class="language-text"><code>dotnet %Luban.ClientServer.dll%
 -j cfg ^
 -- ^
 --define_file &lt;__root__.xml 定义文件的路径&gt; ^
 --input_data_dir &lt;配置数据根目录(Datas)的路径&gt; ^
 --output_data_dir &lt;导出的数据文件的路径&gt; ^
 --service all ^
 --gen_types data_json2

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>其中</p> <ul><li>%Luban.ClientServer.dll% 指向  luban_examples/Tools/Luban.ClientServer/Luban.ClientServer.dll</li> <li>--define_file  参数为 MyConfigs/Defines/__root__.xml 的路径</li> <li>--input_data_dir 参数为 MyConfigs/Datas 的路径</li> <li>--output_data_dir 参数为生成的数据文件的存放路径。 建议指向Assets同级目录。</li></ul> <p>此时运行脚本。应该能执行成功。生成的数据在 --output_data_dir 参数指定的目录下</p> <h2 id="其他项目类型"><a href="#其他项目类型" class="header-anchor">#</a> 其他项目类型</h2> <p>不同项目之间，仅仅是准备工作及 --gen_types 不一样， 请从<a href="https://github.com/focus-creative-games/luban_examples/tree/main/Projects" target="_blank" rel="noopener noreferrer">示例项目<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中找到与你项目匹配的项目，参考相应目录下的 gen_xxx.bat 即可。</p> <p>生成的代码一般会依赖于一些工具类，请从相应项目里拷贝这些代码到自己项目即可。</p> <p>更多可以参考 <a href="generate_code_data">代码与数据生成</a> 这个文档。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/8/2022, 3:09:12 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/lubandoc/Home.html" class="prev">
        Home
      </a></span> <span class="next"><a href="/lubandoc/best_practices.html">
        最佳实践
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/lubandoc/assets/js/app.8b947d15.js" defer></script><script src="/lubandoc/assets/js/2.e9b74d21.js" defer></script><script src="/lubandoc/assets/js/34.aeee1c9f.js" defer></script>
  </body>
</html>
